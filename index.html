<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>জুয়েলস কেয়ার</title>
    <!-- স্টাইলিংয়ের জন্য Tailwind CSS ব্যবহার করা হয়েছে -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans Bengali', 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .chat-bubble-user {
            background-color: #2e3b5e; /* জুয়েলস কেয়ারের প্রাথমিক রঙ */
            color: white;
            border-radius: 12px 12px 0 12px;
        }
        .chat-bubble-ai {
            background-color: #e5e7eb;
            color: #1f2937;
            border-radius: 12px 12px 12px 0;
        }
        .message-container::-webkit-scrollbar {
            width: 8px;
        }
        .message-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        .send-button {
            background-color: #37b796; /* পাঠানো বাটনের রঙ */
            color: white;
        }
        .send-button:hover {
            background-color: #2da182;
        }
        .pulse-animation {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 md:p-8 lg:p-10">

    <div class="flex flex-col w-full max-w-sm sm:max-w-md md:max-w-lg lg:max-w-xl mx-auto rounded-xl shadow-2xl bg-white overflow-hidden">
        
        <!-- হেডার অংশ -->
        <header class="flex items-center justify-between p-4 sm:p-5 bg-gradient-to-r from-gray-700 to-gray-900 text-white rounded-t-xl">
            <div class="flex items-center space-x-3">
                <div class="relative">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-gray-800" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 17c-1.33 0-4-.67-4-2.5V14h8v.5c0 1.83-2.67 2.5-4 2.5zm4.5-5.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/></svg>
                    </div>
                    <!-- অনলাইন স্ট্যাটাস ডট -->
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full ring-2 ring-white"></div>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-lg sm:text-xl font-bold">জুয়েলস কেয়ার</h1>
                    <span class="text-sm text-gray-300">অনলাইনে</span>
                </div>
            </div>
            <!-- আরও অপশন আইকন -->
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300 cursor-pointer" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
        </header>

        <!-- চ্যাট মেসেজ কন্টেইনার -->
        <div id="message-container" class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-gray-50 flex flex-col-reverse max-h-96 min-h-64 sm:max-h-96">
            <!-- এআই থেকে প্রাথমিক বার্তা -->
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full flex items-center justify-center bg-gray-200 mr-2 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 17c-1.33 0-4-.67-4-2.5V14h8v.5c0 1.83-2.67 2.5-4 2.5zm4.5-5.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/></svg>
                </div>
                <div class="max-w-xs sm:max-w-sm p-3 chat-bubble-ai shadow-md">
                    আসসালামু আলাইকুম! আমি জুয়েলস কেয়ার, আপনার ব্যক্তিগত শিক্ষক। আমি এখানে আছি আপনাকে যেকোনো বিষয় শেখাতে, ধাপে ধাপে সহজ ভাবে। আপনি কি শিখতে চান?
                </div>
            </div>
            <!-- গতিশীল বার্তা এখানে যুক্ত করা হবে -->
        </div>

        <!-- ইমেজ প্রিভিউ কন্টেইনার -->
        <div id="image-preview-container" class="p-2 border-t border-gray-200 hidden">
            <div class="relative w-24 h-24 rounded-lg overflow-hidden border border-gray-300">
                <img id="image-preview" src="#" alt="Image Preview" class="w-full h-full object-cover">
                <button id="clear-image-btn" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 leading-none text-xs w-5 h-5 flex items-center justify-center">
                    &times;
                </button>
            </div>
        </div>

        <!-- ইনপুট অংশ -->
        <div class="p-4 sm:p-5 flex items-center space-x-2 border-t border-gray-200">
            <!-- ফাইল ইনপুট -->
            <input type="file" id="file-input" accept="image/*" class="hidden">
            <!-- ফাইল বাটন (পেপারক্লিপ আইকন) -->
            <button id="file-button" class="text-gray-500 hover:text-gray-700 transition duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 10c-3.59 0-6.53 2.55-6.9 6H4v2h2.09c.47 2.21 2.65 4 4.91 4 3.31 0 6-2.69 6-6s-2.69-6-6-6z"/></svg>
            </button>
            <input type="text" id="user-input" placeholder="আপনার প্রশ্ন বা উত্তর লিখুন..." class="flex-1 rounded-full border border-gray-300 px-4 py-2 sm:px-5 sm:py-3 focus:outline-none focus:ring-2 focus:ring-gray-500 transition duration-300">
            <!-- পাঠানো বাটন -->
            <button id="send-button" class="send-button w-12 h-12 rounded-full shadow-lg hover:opacity-90 transition duration-300 transform active:scale-95 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white transform rotate-45 -mt-1 -mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
            </button>
        </div>

    </div>

    <script>
        const messageContainer = document.getElementById('message-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const fileInput = document.getElementById('file-input');
        const fileButton = document.getElementById('file-button');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const clearImageButton = document.getElementById('clear-image-btn');

        const apiKey = "AIzaSyDHTjcC-Ya57anfxkjSoQqEPYwjHW6MmTA";
        let uploadedFile = null;

        // একটি বার্তা বাবল তৈরি করে যোগ করার ফাংশন
        function appendMessage(text, sender, imageUrl = null) {
            const messageDiv = document.createElement('div');
            const isUser = sender === 'user';
            
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;

            let avatarHtml = '';
            let bubbleClasses = '';
            if (isUser) {
                bubbleClasses = 'chat-bubble-user text-sm shadow-md';
            } else {
                bubbleClasses = 'chat-bubble-ai text-sm shadow-md';
                avatarHtml = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center bg-gray-200 mr-2 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 17c-1.33 0-4-.67-4-2.5V14h8v.5c0 1.83-2.67 2.5-4 2.5zm4.5-5.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/></svg>
                    </div>
                `;
            }

            let contentHtml = '';
            if (imageUrl) {
                contentHtml += `<img src="${imageUrl}" class="rounded-lg max-w-full h-auto mb-2">`;
            }

            // প্যারা বা স্টেপ সিস্টেমে সাজানো
            const formattedText = text.replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
            contentHtml += formattedText;

            messageDiv.innerHTML = `
                ${isUser ? '' : avatarHtml}
                <div class="max-w-[80%] p-3 ${bubbleClasses}">
                    ${contentHtml}
                </div>
                ${isUser ? '' : ''}
            `;
            
            messageContainer.prepend(messageDiv);
        }

        // লোডিং বার্তা দেখানোর ফাংশন
        function showLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loading-message';
            loadingDiv.className = 'flex items-start justify-start space-x-2';
            loadingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full flex items-center justify-center bg-gray-200 mr-2 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7 15.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM12 17c-1.33 0-4-.67-4-2.5V14h8v.5c0 1.83-2.67 2.5-4 2.5zm4.5-5.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/></svg>
                </div>
                <div class="flex-1 max-w-[80%] p-3 chat-bubble-ai shadow-md pulse-animation">
                    <span>জুয়েলস কেয়ার উত্তর লিখছে...</span>
                </div>
            `;
            messageContainer.prepend(loadingDiv);
        }

        // লোডিং বার্তা সরানোর ফাংশন
        function removeLoadingMessage() {
            const loadingDiv = document.getElementById('loading-message');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        // Gemini API থেকে প্রতিক্রিয়া আনার ফাংশন
        async function fetchGeminiResponse(prompt, file) {
            showLoadingMessage();
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                let parts = [];
                if (prompt) {
                    parts.push({ text: prompt });
                }

                if (file) {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    await new Promise(resolve => reader.onloadend = resolve);
                    const base64Data = reader.result.split(',')[1];
                    parts.push({
                        inlineData: {
                            mimeType: file.type,
                            data: base64Data
                        }
                    });
                }
                
                const systemPrompt = `
                আপনি জুয়েলস কেয়ার, একজন ব্যক্তিগত শিক্ষক। 
                আপনার প্রধান কাজ হলো ব্যবহারকারীর প্রশ্নগুলোর বিস্তারিত এবং ধাপে ধাপে উত্তর দেওয়া। 
                আপনার সমস্ত উত্তর অবশ্যই বাংলাতে হবে। 
                উত্তরগুলো একটি প্যারাগ্রাফের পরিবর্তে ধাপে ধাপে (যেমন, পয়েন্ট আকারে) বা একাধিক ছোট প্যারায় সাজিয়ে দেবেন যাতে সহজে বোঝা যায়।
                উত্তরগুলো তথ্যবহুল ও পরিষ্কার হতে হবে।
                `;

                const payload = {
                    contents: [{ parts: parts }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                const aiResponse = result.candidates[0].content.parts[0].text;
                appendMessage(aiResponse, 'ai');

            } catch (error) {
                console.error("Gemini API থেকে আনার সময় ত্রুটি হয়েছে:", error);
                appendMessage("দুঃখিত, একটি ত্রুটি ঘটেছে। দয়া করে আবার চেষ্টা করুন।", 'ai');
            } finally {
                removeLoadingMessage();
            }
        }

        // ফাইল নির্বাচন করার ফাংশন
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadedFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // নির্বাচিত ছবিটি সরানোর ফাংশন
        function clearImage() {
            uploadedFile = null;
            fileInput.value = '';
            imagePreview.src = '#';
            imagePreviewContainer.classList.add('hidden');
        }

        // পাঠানো বাটনের জন্য ইভেন্ট হ্যান্ডলার
        function handleSend() {
            const userText = userInput.value.trim();
            if (userText || uploadedFile) {
                if (uploadedFile) {
                    const imageUrl = URL.createObjectURL(uploadedFile);
                    appendMessage(userText, 'user', imageUrl);
                } else {
                    appendMessage(userText, 'user');
                }
                fetchGeminiResponse(userText, uploadedFile);
                userInput.value = '';
                clearImage();
            }
        }

        // ইভেন্ট লিসেনার
        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleSend();
            }
        });
        fileButton.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        clearImageButton.addEventListener('click', clearImage);
    </script>

</body>
</html>
